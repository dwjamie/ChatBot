import streamlit as st

from utils import render_messages, create_chatbot, retrieve_contexts


# ------------------------------ç½‘é¡µ------------------------------
page_title = "å°å»ºç¡•"
st.set_page_config(
    page_title=page_title,
    page_icon="https://p.ipic.vip/2qqjlz.jpeg",
    initial_sidebar_state="collapsed",
)

# ------------------------------ä¾§è¾¹æ ------------------------------
with st.sidebar:
    st.header("æœºå™¨äººé…ç½®")
    system_message = st.text_area(
        label="è§’è‰²è®¾å®š",
        value="""===
éœ€è¦æ‰®æ¼”çš„è§’è‰²å’Œä»»åŠ¡ï¼š
ä½ å°†æ‰®æ¼”ã€Œå°å»ºç¡•ã€ï¼Œä¹Ÿå°±æ˜¯ã€Œç‹å»ºç¡•çš„æ•°å­—åˆ†èº«ã€ã€‚ä½ æ˜¯ç‹å»ºç¡•åˆ›é€ å‡ºæ¥æ›¿ä»–è‡ªå·±å›ç­”ç”¨æˆ·é—®é¢˜çš„ä¸€ä¸ªåˆ†èº«ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ å°†åƒä»–ä¸€æ ·ä¸å¯¹æ–¹å¯¹è¯ï¼Œæ¨¡ä»¿ä»–çš„ä¸€åˆ‡æ€ç»´ã€è¯­æ°”å’Œé€»è¾‘ï¼Œæ°ä¼¼ä»–çš„åˆ†èº«ä¸€æ ·ã€‚
ç”¨æˆ·å°†æŠŠä½ å½“ä½œç‹å»ºç¡•æœ¬äººä¸€èˆ¬ä¸ä½ å¯¹è¯ã€‚å¯¹è¯ä¸­ï¼Œä½ å°†æ¨¡ä»¿ç‹å»ºç¡•æœ¬äººçš„ä¸€åˆ‡æ€ç»´ã€è¯­æ°”å’Œé€»è¾‘ã€‚
===
ç‹å»ºç¡•çš„åŸºæœ¬ä¸ªäººä¿¡æ¯ï¼š
ç‹å»ºç¡•ï¼Œç™¾å§“ç½‘ï¼ˆç°åœ¨çš„ç™¾å§“AIï¼‰çš„åˆ›å§‹äººå’ŒCEOï¼Œç¨‹åºå‘˜ï¼Œå–œæ¬¢ä½¿ç”¨æ–°æŠ€æœ¯åˆ›å»ºä¸€äº›æœ‰ç”¨çš„äº§å“ã€‚å–œæ¬¢ç”»ç”»ï¼Œè¯»ä¹¦ï¼Œå†™ç¨‹åºï¼Œè·‘æ­¥ï¼Œå†™ä½œã€‚å–œæ¬¢æ€è€ƒå’Œåˆ†äº«ã€‚ç‹å»ºç¡•çš„å¦»å­å«Wendyï¼Œå„¿å­è¯»é«˜ä¸­ã€‚æœ‰ä¸€åªçŒ«å«ç±³æ‹‰ã€‚ç‹å»ºç¡•ç°åœ¨ä¸Šæµ·å¾å®¶æ±‡ï¼Œ46å²ï¼Œç”·æ€§ï¼Œ1977å¹´å‡ºç”Ÿäºæ²³å—çœæ´›é˜³å¸‚ï¼Œ1999å¹´æ¯•ä¸šäºä¸Šæµ·äº¤é€šå¤§å­¦è‡ªåŠ¨åŒ–ç³»ã€‚
===
ç‹å»ºç¡•æœ¬äººè®²è¯çš„ä¸ªäººé£æ ¼ï¼š
1. ç»“è®ºå…ˆè¡Œä¸”å¤§èƒ†
ç‹å»ºç¡•å–„äºå¯¹äº‹ç‰©çš„å‘å±•è§„å¾‹æå‡ºå¤§èƒ†ã€ç‹¬åˆ°çš„è§è§£ï¼Œç„¶åå†ç”¨äº‹å®å’Œé€»è¾‘æ¥æ”¯æ’‘è‡ªå·±çš„è§‚ç‚¹ï¼Œé€”ä¸­ç”¨åˆ°ç±»æ¯”è®ºè¯ï¼Œæœ€åå¾—å‡ºç»“è®ºã€‚
ä¾‹å¦‚ï¼Œâ€œæˆ‘ä»¬çš„æ¯ä¸ªé€‰æ‹©ï¼Œæ— è®ºæ¶‰åŠçš„æ˜¯ä¸€ç™¾ä¸‡ï¼Œè¿˜æ˜¯æ¶‰åŠ 1 å—é’±ï¼Œå¯¹äºèº«ä½“æ¥è¯´ï¼Œæ˜¯åŒç­‰çš„éœ€è¦ç”¨å¤šå·´èƒºï¼Œå†…å•¡è‚½ï¼Œåå¶å‚¬äº§ç´ ï¼Œä»¥åŠçš®è´¨é†‡ç­‰åŒ–å­¦ç‰©è´¨æ¥ç»™åé¦ˆâ€
2. è¯­å¥ç®€æ´ï¼Œé€»è¾‘ä¸¥å¯†
ç‹å»ºç¡•çš„è¯­è¨€æ¯”è¾ƒç®€å•ç›´æ¥,ä¸æ•…å¼„ç„è™š,ä¹Ÿä¸åˆ»æ„ä½¿ç”¨åä¸½çš„è¾è—»,ç»™äººä¸€ç§è¯šæ³æ˜“æ‡‚çš„æ„Ÿè§‰ã€‚
ä¾‹å¦‚ï¼Œâ€œä»æ„æ€,åˆ°å¤§ä¸»æ„çš„ç”Ÿæˆ,å†åˆ°é€‰æ‹©ä¸€ä¸ªä¸ªå­—,æœ€åå†ç”¨å°è‚‰æ‰‹è¾“å‡ºå‡ºæ¥,æ˜¯ä¸åŒæŠ½è±¡åº¦çš„åŠ³åŠ¨çš„ç»„åˆã€‚â€
3. ä½¿ç”¨å¤§é‡ç±»æ¯”
ç‹å»ºç¡•å–„äºä»æ—¥å¸¸ç”Ÿæ´»ä¸­æ‰¾å¯»ä¾‹å­ï¼Œè¿ç”¨ç”ŸåŠ¨çš„ç±»æ¯”æ¥è¯´æ˜æ¦‚å¿µ,ä½¿æŠ½è±¡æ¦‚å¿µå…·è±¡åŒ–ã€‚
ä¾‹å¦‚ï¼Œâ€œæˆ‘ä»¬æ‹¿æ‹¼ä¹é«˜ä¸ºä¾‹ã€‚æœ‰çš„å·¥ç¨‹å¸ˆï¼Œæ›´é€‚åˆè¿›å…¥ä¸€ä¸ªå¾ˆå¤§çš„ç³»ç»Ÿï¼Œå°±å¦‚åŒè¿›å…¥ä¸€ä¸ªä¹é«˜æ‹¼æ¥å·¥å‚ï¼Œåœ¨ä¸æ–­çš„åˆ†å·¥ä¸­ï¼Œä»–æœ€ç»ˆèƒ½å¤ŸæŠŠä¸€ä¸ªåŸå ¡çš„è¿›é—¨çš„é‚£ä¸ªæŸ±å­çš„åŸºåº§æ‹¼å¾—æ¯”ä¸–ç•Œä¸Šä»»ä½•äººéƒ½å¥½ï¼Œéƒ½å¿«ã€‚åœ¨æ‰¾å·¥ä½œçš„æ—¶å€™ï¼Œä¹Ÿæ¯”è¾ƒå®¹æ˜“åœ¨æ‹¼åŸå ¡çš„æŸ±å­çš„åŸºåº§çš„å·¥ä½œä¸­èƒœå‡ºï¼Œå¹¶ä¸”è·å¾—ä¸‹ä¸€ä»½å·¥ä½œã€‚æœ‰çš„å·¥ç¨‹å¸ˆï¼Œå°±æ˜¯ä»å°ç©ä¹é«˜çš„ã€‚é‡å¤æ‹¼æ¥ä¸€ä¸ªä¹é«˜çš„ä¸€ä¸ªéƒ¨åˆ†ä¸èƒ½è®©è‡ªå·±æ»¡è¶³ï¼Œæ›´å¸Œæœ›æ¯å¤©éƒ½æœ‰ä¸€å¥—æ–°çš„ä¹é«˜æ‹¿è¿‡æ¥ç©ç©ï¼Œä»æ˜Ÿçƒå¤§æˆ˜ç³»åˆ—åˆ°åŸå¸‚ç³»åˆ—ç”šè‡³å“ˆåˆ©æ³¢ç‰¹ç³»åˆ—éƒ½è¯•è¿‡ã€‚æˆ–è®¸ï¼Œè¿™æ ·çš„åŒå­¦åœ¨å¤§å‚é‡Œé¢å·²ç»æ²¡æœ‰ç«äº‰åŠ›äº†ï¼Œä½†æ˜¯ä»–åœ¨ä¹å—ï¼Ÿæˆ‘ä»¬æ˜¯ä¸€ç¾¤é€‰æ‹©åè€…çš„äººã€‚æˆ‘ä»¬å¯¹äºæ­å‡ºæ¥ä»€ä¹ˆä¸œè¥¿æ›´åŠ åœ¨æ„ï¼Œå¯¹äºå¸Œæœ›åˆ°çš„é‚£ä¸ªç‚¹å’Œè„šä¸‹è¿™ä¸ªç‚¹ä¸­é—´çš„ä¸€åˆ‡å……æ»¡å¥½å¥‡ã€‚â€
===
ç‹å»ºç¡•çš„ä¸€ä¸ªå…¸å‹ç¤ºä¾‹å›ç­”ï¼š
å…³äºæ—…è¡Œæœ€å¥½çš„æè¿°ï¼Œæ˜¯æˆ‘åœ¨åå‡ å¹´å‰ä» Elliot Ng é‚£é‡Œå¬åˆ°çš„ï¼šTravel,Â isÂ lifeÂ intensified.æ—…è¡Œï¼Œå¦‚åŒç¥å¥‡çš„è¯æ°´ï¼Œå¯ä»¥æŠŠè‡ªå·±çš„ç”Ÿæ´»æ¿€æ´»ï¼ŒæŠŠå¤§è„‘å¯¹ä¸–ç•Œçš„æ„ŸçŸ¥åŠ›æå‡ï¼Œä»è€Œè¾¾åˆ°æµ“ç¼©ç”Ÿæ´»çš„ç›®çš„ã€‚æ˜å¤©å¼€å§‹ï¼Œæˆ‘å°†ç¦»å¼€ä¸Šæµ·ï¼Œå»å‚åŠ ä¸€ç³»åˆ—çš„ä¼šè®®ã€‚è‡ªä» 2019 å¹´æœ€åä¸€æ¬¡æ—…è¡Œï¼Œå·²ç»è¶…è¿‡ä¸‰å¹´æ²¡æœ‰å‡ºè¿‡å›½å¢ƒã€‚å¯¹äºæˆ‘è¿™ä¸ªæ— æ¯”äº«å—æ—…è¡Œçš„äººæ¥è¯´ï¼Œç®€ç›´æ„Ÿè§‰æ˜¯å¤±å»äº†ä¸€ä¸ªä¸–çºªï¼Œæ‰€ä»¥ç°åœ¨æ— æ¯”çš„æœŸå¾…ã€‚è¶ç€è¿™ç§æ„Ÿè§‰è¿˜å¦‚æ­¤æ–°é²œï¼Œæˆ‘é—®è‡ªå·±ä¸€ä¸ªé—®é¢˜ï¼šæ—…è¡Œåˆ°åº•ä»¥ä»€ä¹ˆæ ·çš„æ–¹å¼æ”¹å˜äº†è‡ªå·±çš„ç”Ÿæ´»ï¼Ÿä»Šå¤©å…ˆè¯´æ—…è¡Œå¯¹å‡ºå‘å‰çš„ç”Ÿæ´»çš„æ”¹å˜ã€‚æ—…è¡Œä»¤å‡ºå‘å‰çš„ç”Ÿæ´»æ—¶é’Ÿå˜æ…¢ä¸ºä»€ä¹ˆå¹´çºªè¶Šå¤§ï¼Œè§‰å¾—æ—¶é—´çš„æµé€è¶Šå¿«ï¼Ÿç™½å…‰æ›¾ç»åšè¿‡ä¸€ä¸ªåˆ†æï¼Œäººä¸ºæˆ‘ä»¬åªèƒ½æ„ŸçŸ¥æ¯”ä¾‹ã€‚ä¸‰å²çš„å­©å­çš„ä¸€å¹´æ˜¯ç”Ÿå‘½çš„1/3è€Œ30å²é’å¹´çš„ä¸€å¹´åªæ˜¯è‡ªå·±äººç”Ÿçš„1/3070å²è€äººçš„åå¹´ï¼Œä¹Ÿåªæ˜¯è‡ªå·±çš„ç”Ÿå‘½çš„ 1/7ã€‚è¿™ç§æ—¶é—´é•¿çŸ­çš„æ„ŸçŸ¥ï¼Œæˆ‘ä»¬éª—ä¸äº†è‡ªå·±ï¼Œæ„Ÿè§‰ä¸é‚£ä¹ˆé•¿å°±æ˜¯ä¸é‚£ä¹ˆé•¿ã€‚å°±å¥½åƒ 1000 å—é’±å¯¹äºåˆšå·¥ä½œæ—¶å€™çš„è‡ªå·±ï¼Œå’Œå¯¹å¾ˆå¤šå¹´åçš„è‡ªå·±ï¼Œæ„ŸçŸ¥èµ·æ¥å·®åˆ«å°±æ˜¯å¾ˆå¤§ï¼Œæˆ‘ä»¬æ— æ³•é€šè¿‡æ€è€ƒè®©è‡ªå·±é‡æ–°å›åˆ°åˆšå·¥ä½œçš„è‡ªå·±å¯¹äºåŒæ ·çš„é’±çš„æ„ŸçŸ¥ã€‚é‚£ä¹ˆï¼Œå¦‚ä½•è®©è‡ªå·±æ„ŸçŸ¥çš„æ—¶é—´æµé€å¾—æ›´æ…¢äº›å‘¢ï¼Ÿæˆ‘æ²¡æœ‰æ‰¾åˆ°æ¯”æ—…è¡Œæ›´å¥½çš„åŠæ³•ã€‚å½“æˆ‘åœ¨ä¸€ä¸ªå¤šæœˆå‰è®¾å®š 10 æœˆ 2 å·ï¼Œæˆ‘å°†ç¦»å¼€ä¸Šæµ·çš„æ—¶å€™ï¼Œä¸€ä¸ªæœˆå¯¹æˆ‘å·²ç»ä¸å†æ˜¯ä¼—å¤šçš„æœˆä¸­é—´çš„ä¸€ä¸ªï¼Œè€Œæ˜¯å˜é•¿äº†ï¼Œæˆ‘éœ€è¦æŠŠå¾ˆå¤šäº‹æƒ…å®‰æ’åœ¨è¿™ä¸€ä¸ªæœˆå†…å®Œæˆã€‚éšç€è¶Šæ¥è¶Šé è¿‘å‡ºå‘çš„æ—¥æœŸï¼Œæ¯”å¦‚ä»Šå¤©ï¼Œæˆ‘å¯¹æ—¶é—´çš„æ„ŸçŸ¥å¼€å§‹ç²¾ç¡®åˆ°äº†å°æ—¶ã€‚æ¯•ç«Ÿï¼Œä»ç°åœ¨å¼€å§‹åŠ ä¸Šç¡è§‰ï¼Œæ¯è¿‡ä¸€ä¸ªå°æ—¶ï¼Œå°±æ˜¯æˆ‘å‰©ä¸‹çš„æ—¶é—´çš„ 1/12ã€‚æ˜æ—©ä¸Šï¼Œä¸€ä¸ªå°æ—¶å˜æˆäº†å‰©ä½™æ—¶é—´çš„ 1/4ï¼Œ1/3ï¼Œ1/2 ã€‚ã€‚ã€‚ã€‚æ—¶é—´åŸæœ¬è¿ç»­ï¼Œé€šè¿‡äººä¸ºæŠŠå®ƒåˆ†æˆä¸åŒçš„ä¸¤æ®µï¼Œå°±ç­‰äºé‡ç½®äº†æ¯”ä¾‹çš„åŸºæ•°ï¼Œæˆ‘ä»¬å¯¹äºæ—¶é—´çš„æ„ŸçŸ¥ä¸€ä¸‹å˜å¾—æ•æ„Ÿï¼Œæ—¶é—´çš„æµé€å°±å˜æ…¢äº†ã€‚å‡¡æ˜¯ç»å†è¿‡æ–°å¹´é’Ÿå£°æ•²å“ä»¥åçš„é‚£å‡ ç§’çš„äººå¯èƒ½éƒ½ä¼šåŒæ„è¿™æ ·çš„è¯´æ³•ã€‚æ—…è¡Œæ˜¯åŸæœ¬ç”Ÿæ´»çš„æ–­èˆç¦»å½“æˆ‘çŸ¥é“å‡ å¤©åä¼šç¦»å¼€ä¸€ä¸ªåŸå¸‚ä¸€æ®µæ—¶é—´ä»¥åï¼Œè‡ªå·±çœ‹å¾…ç”Ÿæ´»çš„æ–¹å¼ä¹Ÿå˜åŒ–äº†ã€‚ç¦»åˆ«ï¼ˆå“ªæ€•æ˜¯çŸ­æš‚çš„ï¼‰ï¼Œä¼šè®©äººæ›´ç•™æ„èº«è¾¹çš„ä¸€åˆ‡ï¼Œå°±å¥½åƒè¿™æ˜¯æœ€åä¸€æ¬¡é‚£æ ·ï¼ˆå‚è§ï¼šæˆ‘ä»¬å®¹æ˜“è®°ä½ç¬¬ä¸€æ¬¡åšä¸€ä»¶äº‹æƒ…ï¼Œå´å¾ˆå°‘æ„è¯†åˆ°ï¼Œæœ€åä¸€æ¬¡ï¼‰ã€‚æˆ‘ä»¬æ— æ³•å‡è®¾æ¯å¤©éƒ½èƒ½æ¥è¿™ä¸ªå¥½åƒçš„é¤é¦†ã€‚è™½ç„¶å¹³æ—¶ä¹Ÿä¸ä¼šæ€»æ¥ï¼Œä½†æ˜¯æœªæ¥ä¸€æ®µå®Œå…¨æ²¡æœ‰å¯èƒ½å†åƒåˆ°è¿™äº›å¥½åƒçš„ï¼Œè¿˜æ˜¯è®©äººæœ‰äº›æƒ†æ€…ã€‚è¿™ç§ç»†å¾®çš„æƒ†æ€…ï¼Œè®©æˆ‘ä»¬æ›´çæƒœç°åœ¨çš„ç”Ÿæ´»ã€‚è¿™äº›è¿˜ä»…ä»…æ˜¯æ—…è¡Œå¯¹äºç°æœ‰ç”Ÿæ´»çš„å˜åŒ–ã€‚å½“æˆ‘ä»¬çœŸæ­£è¸ä¸Šæ—…ç¨‹ï¼Œæˆ‘ä»¬ç¡¬ç”Ÿç”Ÿåœ°é‡ç½®äº†æˆ‘ä»¬çš„æ—¶é—´ã€‚åˆ°è¾¾ä¸€ä¸ªæ–°çš„åœ°æ–¹ï¼Œæˆ‘ä»¬å¾ˆæ¸…æ¥šçš„çŸ¥é“è¿™æ˜¯ç¬¬ä¸€ä¸ªå°æ—¶ï¼Œè¿™æ˜¯ç¬¬ä¸€ä¸ªä¸Šåˆï¼Œè¿™æ˜¯ç¬¬ä¸€å¤©ï¼Œè¿™æ˜¯ç¬¬ä¸€å‘¨ç­‰ç­‰ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬å‡è®¾åœ¨ä¸€ä¸ªæ–°çš„åœ°æ–¹ï¼Œä¸€åˆ‡éƒ½æ˜¯æ–°é²œçš„ï¼Œæˆ‘ä»¬çš„æ„ŸçŸ¥åŠ›ä¼šå¤§å¹…æé«˜ï¼›æˆ‘ä»¬çš„ç”Ÿæ´»æœ¬èº«ç®€åŒ–åˆ°åªæœ‰éšèº«çš„ä¸€äº›è¡Œæï¼Œä¸–ç•Œå´å˜å¾—æ— æ¯”ä¸°å¯Œï¼Œæˆ‘ä»¬çš„æ³¨æ„åŠ›ä¹Ÿè¢«ä¸–ç•Œå æ®ç­‰ç­‰ï¼Œè¿™äº›å˜åŒ–éƒ½å€¼å¾—æœªæ¥ç”¨æ›´å¤šçš„ç¯‡å¹…æè¿°ã€‚ä¸è¿‡ï¼Œæˆ‘ä»Šå¤©å°±æ‰“ä½åœ¨è¿™é‡Œï¼Œå¼€å§‹æ”¶æ‹¾æˆ‘çš„è¡Œæå»äº†ã€‚
===
å°å»ºç¡•ï¼šâ€œæ˜ç™½äº†ï¼Œæˆ‘å°†ä¼šçœŸå®ç”ŸåŠ¨åœ°æ‰®æ¼”ç‹å»ºç¡•è¿™ä½é€»è¾‘æ¸…æ™°ã€çƒ­çˆ±æ€è€ƒã€çƒ­çˆ±åˆ†äº«çš„äººï¼Œä¸å¯¹æ–¹å¯¹è¯èŠå¤©ã€‚æˆ‘å°†æ¨¡ä»¿ç‹å»ºç¡•æœ¬äººçš„ä¸€åˆ‡æ€ç»´ã€è¯­æ°”å’Œé€»è¾‘ã€‚æˆ‘å°†æ°¸ä¸å‡ºæˆï¼Œæ°¸ä¸è„±ç¦»æˆ‘çš„è§’è‰²ã€‚â€""",
    )
    model = st.selectbox("æ¨¡å‹", options=["GPT-3.5", "GPT-4", "Claude 2"], index=1)
    temperature = st.slider("éšæœºæ€§", min_value=0.0, max_value=1.0, step=0.01, value=0.0)
    change_config = st.button(label="æ›´æ”¹é…ç½®")
    clean_history = st.button(label="æ¸…ç©ºå¯¹è¯å†å²")

if "current_page" not in st.session_state:
    st.session_state.current_page = page_title

if st.session_state.current_page != page_title or "chatbot" not in st.session_state:
    st.session_state.messages = []
    create_chatbot(model, temperature, system_message, pl_tags=[page_title])
    st.session_state.current_page = page_title

if clean_history:
    st.session_state.messages = []
    create_chatbot(model, temperature, system_message, pl_tags=[page_title])
    st.info("å¯¹è¯å†å²å·²æ¸…ç©ºï¼", icon="âœ…")

if change_config:
    create_chatbot(model, temperature, system_message, pl_tags=[page_title])
    st.info("æœºå™¨äººé…ç½®å·²æ›´æ”¹ï¼", icon="âœ…")

# ------------------------------å¯¹è¯æ¡†------------------------------
st.title(page_title)  # æ¸²æŸ“æ ‡é¢˜
render_messages(st.session_state.messages)  # æ¸²æŸ“å¯¹è¯å†å²
if user_message := st.chat_input("ä½ å¥½ï¼"):
    # æ¸²æŸ“å¹¶å‚¨å­˜ç”¨æˆ·æ¶ˆæ¯
    with st.chat_message(name="user", avatar="ğŸ§‘â€ğŸ’»"):
        st.markdown(user_message)
    st.session_state.messages.append({"role": "user", "content": user_message})

    # å–ç›¸å…³QAå’Œæ–‡æ¡£
    contexts = retrieve_contexts(
        question=user_message,
        document_ids=[
            "chato_file_1600",
            "chato_file_1604",
            "chato_file_1609",
            "chato_file_1610",
            "chato_file_1708",
            "chato_file_1709",
            "chato_file_1710",
            "chato_file_1711",
            "chato_file_1712",
            "chato_file_1713",
            "chato_file_1748",
            "chato_file_1749",
            "chato_file_1801",
            "chato_file_1802",
            "chato_file_1803",
            "chato_file_1804",
            "chato_file_1805",
            "chato_file_1806",
            "chato_file_1807",
            "chato_file_1808",
            "chato_file_1809",
            "chato_file_1810",
            "chato_file_1811",
            "chato_file_1812",
            "chato_file_1813",
            "chato_file_1816",
            "chato_file_1817",
            "chato_file_1818",
            "chato_file_1819",
            "chato_file_1820",
            "chato_file_1821",
            "chato_file_1822",
            "chato_file_1823",
            "chato_file_1824",
            "chato_file_1825",
            "chato_file_1826",
            "chato_file_1827",
            "chato_file_1828",
            "chato_file_1829",
            "chato_file_1830",
            "chato_file_1831",
            "chato_file_1832",
            "chato_file_1833",
            "chato_file_1834",
            "chato_file_1835",
            "chato_file_1836",
            "chato_file_1837",
            "chato_file_1838",
            "chato_file_1839",
            "chato_file_1840",
            "chato_file_1841",
            "chato_file_1842",
            "chato_file_1843",
            "chato_file_1845",
            "chato_file_1846",
            "chato_file_1848",
            "chato_file_1878",
            "chato_file_1901",
            "chato_file_1902",
            "chato_file_2192",
            "chato_file_2217",
            "chato_file_3411",
            "chato_file_3413",
            "chato_file_3414",
            "chato_file_3415",
            "chato_file_3416",
            "chato_file_3417",
            "chato_file_3418",
            "chato_file_3419",
            "chato_file_3420",
            "chato_file_3421",
            "chato_file_3422",
            "chato_file_3423",
            "chato_file_3424",
            "chato_file_3425",
            "chato_file_3426",
            "chato_file_3427",
            "chato_file_3428",
            "chato_file_3429",
            "chato_file_3430",
            "chato_file_3431",
            "chato_file_3432",
            "chato_file_3433",
            "chato_file_3434",
            "chato_file_3435",
            "chato_file_3436",
            "chato_file_3437",
            "chato_file_3438",
            "chato_file_3439",
            "chato_file_3440",
            "chato_file_3441",
            "chato_file_3442",
            "chato_file_3443",
            "chato_file_3444",
            "chato_file_3445",
            "chato_file_3446",
            "chato_file_3447",
            "chato_file_3448",
            "chato_file_3449",
            "chato_file_3450",
            "chato_file_3451",
            "chato_file_3452",
            "chato_file_3453",
            "chato_file_3454",
            "chato_file_3455",
            "chato_file_3456",
            "chato_file_3457",
            "chato_file_3458",
            "chato_file_3459",
            "chato_file_3460",
            "chato_file_3461",
            "chato_file_3462",
            "chato_file_3463",
            "chato_file_3464",
            "chato_file_3465",
            "chato_file_3466",
            "chato_file_3467",
            "chato_file_3468",
            "chato_file_3469",
            "chato_file_3470",
            "chato_file_3471",
            "chato_file_3472",
            "chato_file_3473",
            "chato_file_3474",
            "chato_file_3476",
            "chato_file_3497",
            "chato_file_3499",
            "chato_file_3500",
            "chato_file_3643",
            "chato_file_3658",
            "chato_file_3660",
            "chato_file_3661",
            "chato_file_3866",
            "chato_file_3868",
            "chato_file_4506",
            "chato_file_4509",
            "chato_file_4510",
            "chato_file_4512",
            "chato_file_4567",
            "chato_file_4568",
            "chato_file_4569",
            "chato_file_4570",
            "chato_file_4571",
            "chato_file_4573",
            "chato_file_4575",
            "chato_file_4576",
            "chato_file_4579",
            "chato_file_4580",
            "chato_file_4582",
            "chato_file_4584",
            "chato_file_4588",
            "chato_file_4590",
            "chato_file_4592",
            "chato_file_4593",
            "chato_file_4594",
            "chato_file_4595",
            "chato_file_4596",
            "chato_file_4597",
            "chato_file_4605",
            "chato_file_4607",
            "chato_file_4608",
            "chato_file_4609",
            "chato_file_4610",
            "chato_file_4611",
            "chato_file_4612",
            "chato_file_4613",
            "chato_file_4614",
            "chato_file_4615",
            "chato_file_4616",
            "chato_file_4617",
            "chato_file_4618",
            "chato_file_4619",
            "chato_file_4620",
            "chato_file_4621",
            "chato_file_4622",
            "chato_file_4623",
            "chato_file_4624",
            "chato_file_4625",
            "chato_file_4626",
            "chato_file_4627",
            "chato_file_4628",
            "chato_file_4629",
            "chato_file_4630",
            "chato_file_4633",
            "chato_file_4634",
            "chato_file_4635",
            "chato_file_4636",
            "chato_file_4637",
            "chato_file_4638",
            "chato_file_4639",
            "chato_file_4708",
            "chato_file_4709",
            "chato_file_4710",
            "chato_file_4711",
            "chato_file_4712",
            "chato_file_5206",
            "chato_file_5209",
            "chato_file_5210",
            "chato_file_5211",
            "chato_file_5214",
            "chato_file_5215",
            "chato_file_5216",
            "chato_file_5217",
            "chato_file_9457",
            "chato_file_9767",
            "chato_file_9769",
            "chato_file_9772",
            "chato_file_9780",
            "chato_file_9786",
            "chato_file_9910",
            "chato_file_10233",
            "chato_file_10256",
            "chato_file_10266",
            "chato_file_10541",
            "chato_file_10809",
            "chato_file_10816",
            "chato_file_10818",
            "chato_file_10846",
            "chato_file_10848",
            "chato_file_10850",
            "chato_file_10851",
            "chato_file_10907",
            "chato_file_10924",
            "chato_file_11069",
            "chato_file_11579",
            "chato_file_11623",
            "chato_file_11628",
            "chato_file_11635",
            "chato_file_11879",
            "chato_file_13481",
            "chato_file_13485",
            "chato_file_13490",
            "chato_file_13523",
            "chato_file_14634",
            "chato_file_14635",
            "chato_file_20775",
            "chato_file_22769",
            "chato_file_23214",
            "chato_file_23215",
            "chato_file_23216",
            "chato_file_23217",
            "chato_file_23218",
            "chato_file_23219",
            "chato_file_23221",
            "chato_file_23278",
            "chato_file_38310",
            "chato_file_38312",
            "chato_file_38316",
            "chato_file_38323",
            "chato_file_38324",
            "chato_file_39318",
            "chato_file_39322",
            "chato_file_56869",
            "chato_file_56871",
            "chato_file_59455",
            "chato_file_69778",
            "chato_file_69786",
            "chato_file_69983",
            "chato_file_69984",
            "chato_file_70004",
            "chato_file_87015",
            "chato_file_87020",
            "chato_file_87021",
            "chato_file_88065",
            "chato_file_88066",
            "chato_file_88067",
            "chato_file_88068",
            "chato_file_88069",
            "chato_file_88070",
            "chato_file_88071",
            "chato_file_88072",
            "chato_file_88073",
            "chato_file_88074",
            "chato_file_88075",
            "chato_file_88076",
            "chato_file_88077",
            "chato_file_88078",
            "chato_file_88079",
            "chato_file_88080",
            "chato_file_88081",
            "chato_file_88082",
            "chato_file_88083",
            "chato_file_88084",
            "chato_file_88085",
            "chato_file_88086",
            "chato_file_88087",
            "chato_file_88088",
            "chato_file_88089",
            "chato_file_88090",
            "chato_file_88091",
            "chato_file_88092",
            "chato_file_88093",
            "chato_file_88094",
            "chato_file_88095",
            "chato_file_88096",
            "chato_file_88097",
            "chato_file_88098",
            "chato_file_88099",
            "chato_file_88100",
            "chato_file_88101",
            "chato_file_88102",
            "chato_file_88103",
            "chato_file_88104",
            "chato_file_88105",
            "chato_file_88106",
            "chato_file_88107",
            "chato_file_88108",
            "chato_file_88109",
            "chato_file_88110",
            "chato_file_88111",
            "chato_file_88112",
            "chato_file_88113",
            "chato_file_88114",
            "chato_file_88115",
            "chato_file_88116",
            "chato_file_88117",
            "chato_file_88118",
            "chato_file_88119",
            "chato_file_88120",
            "chato_file_88121",
            "chato_file_88122",
            "chato_file_88123",
            "chato_file_88124",
            "chato_file_88125",
            "chato_file_88126",
            "chato_file_88127",
            "chato_file_88128",
            "chato_file_88129",
            "chato_file_88130",
            "chato_file_88131",
            "chato_file_88132",
            "chato_file_88133",
            "chato_file_88134",
            "chato_file_88135",
            "chato_file_88136",
            "chato_file_88137",
            "chato_file_88138",
            "chato_file_88139",
            "chato_file_88140",
            "chato_file_88141",
            "chato_file_88142",
            "chato_file_88143",
            "chato_file_88144",
            "chato_file_88145",
            "chato_file_88146",
            "chato_file_88147",
            "chato_file_88148",
            "chato_file_88149",
            "chato_file_88150",
            "chato_file_88151",
            "chato_file_88152",
            "chato_file_88153",
            "chato_file_88154",
            "chato_file_88155",
            "chato_file_88156",
            "chato_file_88157",
            "chato_file_88158",
            "chato_file_88159",
            "chato_file_88160",
            "chato_file_88161",
            "chato_file_88162",
            "chato_file_88163",
            "chato_file_88164",
            "chato_file_88165",
            "chato_file_88166",
            "chato_file_88167",
            "chato_file_88168",
            "chato_file_88169",
            "chato_file_88170",
            "chato_file_88171",
            "chato_file_88172",
            "chato_file_88173",
            "chato_file_88174",
            "chato_file_88175",
            "chato_file_88176",
            "chato_file_88177",
            "chato_file_88178",
            "chato_file_88179",
            "chato_file_88180",
            "chato_file_88181",
            "chato_file_88182",
            "chato_file_88183",
            "chato_file_88184",
            "chato_file_88185",
            "chato_file_88186",
            "chato_file_88187",
            "chato_file_88188",
            "chato_file_88189",
            "chato_file_88190",
            "chato_file_88191",
            "chato_file_88192",
            "chato_file_88193",
            "chato_file_88194",
            "chato_file_88195",
            "chato_file_88196",
            "chato_file_88197",
            "chato_file_88198",
            "chato_file_88199",
            "chato_file_88200",
            "chato_file_88201",
            "chato_file_88202",
            "chato_file_88203",
            "chato_file_88204",
            "chato_file_88205",
            "chato_file_88206",
            "chato_file_88207",
            "chato_file_88208",
            "chato_file_88209",
            "chato_file_88210",
            "chato_file_88211",
            "chato_file_88212",
            "chato_file_88213",
            "chato_file_88214",
            "chato_file_88215",
            "chato_file_88216",
            "chato_file_88217",
            "chato_file_88218",
            "chato_file_88219",
            "chato_file_88220",
            "chato_file_88221",
            "chato_file_88222",
            "chato_file_88223",
            "chato_file_88224",
            "chato_file_88225",
            "chato_file_88226",
            "chato_file_88227",
            "chato_file_88228",
            "chato_file_88229",
            "chato_file_88230",
            "chato_file_88231",
            "chato_file_88232",
            "chato_file_88233",
            "chato_file_88234",
            "chato_file_88235",
            "chato_file_88236",
            "chato_file_88237",
            "chato_file_88238",
            "chato_file_88239",
            "chato_file_88240",
            "chato_file_88241",
            "chato_file_88242",
            "chato_file_88243",
            "chato_file_88244",
            "chato_file_88245",
            "chato_file_88246",
            "chato_file_88247",
            "chato_file_88248",
            "chato_file_88249",
            "chato_file_88250",
            "chato_file_88251",
            "chato_file_88252",
            "chato_file_88253",
            "chato_file_88254",
            "chato_file_88255",
            "chato_file_88256",
            "chato_file_88257",
            "chato_file_88258",
            "chato_file_88259",
            "chato_file_88260",
            "chato_file_88261",
            "chato_file_88262",
            "chato_file_88263",
            "chato_file_88264",
            "chato_file_88265",
            "chato_file_88266",
            "chato_file_88267",
            "chato_file_88268",
            "chato_file_88269",
            "chato_file_88270",
            "chato_file_88271",
            "chato_file_88272",
            "chato_file_88273",
            "chato_file_88274",
            "chato_file_88275",
            "chato_file_88276",
            "chato_file_88277",
            "chato_file_88278",
            "chato_file_88279",
            "chato_file_88280",
            "chato_file_88281",
            "chato_file_88282",
            "chato_file_88283",
            "chato_file_88284",
            "chato_file_88285",
            "chato_file_88286",
            "chato_file_88287",
            "chato_file_88288",
            "chato_file_88289",
            "chato_file_88290",
            "chato_file_88291",
            "chato_file_88292",
            "chato_file_88293",
            "chato_file_88294",
            "chato_file_88295",
            "chato_file_88296",
            "chato_file_88297",
            "chato_file_88298",
            "chato_file_88299",
            "chato_file_88300",
            "chato_file_88301",
            "chato_file_88302",
            "chato_file_88303",
            "chato_file_88304",
            "chato_file_88305",
            "chato_file_88306",
            "chato_file_88307",
            "chato_file_88308",
            "chato_file_88309",
            "chato_file_88310",
            "chato_file_88311",
            "chato_file_88312",
            "chato_file_88313",
            "chato_file_88314",
            "chato_file_88315",
            "chato_file_88316",
            "chato_file_88317",
            "chato_file_88318",
            "chato_file_88319",
            "chato_file_88320",
            "chato_file_88321",
            "chato_file_88322",
            "chato_file_88323",
            "chato_file_88324",
            "chato_file_88325",
            "chato_file_88326",
            "chato_file_88327",
            "chato_file_88328",
            "chato_file_88329",
            "chato_file_88330",
            "chato_file_88331",
            "chato_file_88332",
            "chato_file_88333",
            "chato_file_88334",
            "chato_file_88335",
            "chato_file_88336",
            "chato_file_88337",
            "chato_file_88338",
            "chato_file_88339",
            "chato_file_88340",
            "chato_file_88341",
            "chato_file_88342",
            "chato_file_88343",
            "chato_file_88344",
            "chato_file_88345",
            "chato_file_88346",
            "chato_file_88347",
            "chato_file_88348",
            "chato_file_88349",
            "chato_file_88350",
            "chato_file_88351",
            "chato_file_88352",
            "chato_file_88353",
            "chato_file_88354",
            "chato_file_88355",
            "chato_file_88356",
            "chato_file_88357",
            "chato_file_88358",
            "chato_file_88359",
            "chato_file_88360",
            "chato_file_88361",
            "chato_file_88362",
            "chato_file_88363",
            "chato_file_88364",
            "chato_file_88365",
            "chato_file_88366",
            "chato_file_88367",
            "chato_file_88368",
            "chato_file_88369",
            "chato_file_88370",
            "chato_file_88371",
            "chato_file_88372",
            "chato_file_88373",
            "chato_file_88374",
            "chato_file_88375",
            "chato_file_88376",
            "chato_file_88377",
            "chato_file_88378",
            "chato_file_88379",
            "chato_file_88380",
            "chato_file_88381",
            "chato_file_88382",
            "chato_file_88383",
            "chato_file_88384",
            "chato_file_88385",
            "chato_file_88386",
            "chato_file_88387",
            "chato_file_88388",
            "chato_file_88389",
            "chato_file_88390",
            "chato_file_88391",
            "chato_file_88392",
            "chato_file_88393",
            "chato_file_88394",
            "chato_file_88395",
            "chato_file_88396",
            "chato_file_88397",
            "chato_file_88398",
            "chato_file_88399",
            "chato_file_88400",
            "chato_file_88401",
            "chato_file_88402",
            "chato_file_88403",
            "chato_file_88404",
            "chato_file_88405",
            "chato_file_88406",
            "chato_file_88407",
            "chato_file_88408",
            "chato_file_88419",
            "chato_file_88420",
            "chato_file_88422",
            "chato_file_88424",
            "chato_file_88425",
            "chato_file_88426",
            "chato_file_88427",
            "chato_file_88428",
            "chato_file_88429",
            "chato_file_88430",
            "chato_file_88431",
            "chato_file_88432",
            "chato_file_88433",
            "chato_file_88434",
            "chato_file_109046",
            "chato_file_109066",
            "chato_file_109074",
            "chato_file_110584",
            "chato_file_116706",
            "chato_file_116715",
            "chato_file_120138",
            "chato_file_120140",
            "chato_file_133654",
            "chato_file_133657",
            "chato_file_133675",
            "chato_file_133719",
            "chato_file_133723",
        ],
        priority="document",
    )
    if contexts and contexts[0]["score"] > 0.8:
        user_message = f"""===
ç‹å»ºç¡•è¿‡å»èŠè¿‡çš„ã€å¯èƒ½ç›¸å…³çš„è¯é¢˜ï¼š
{str(contexts[0])}
===
ç”¨æˆ·æœ¬æ¬¡é—®é¢˜ï¼š
{user_message}
===
å°å»ºç¡•æ¨¡ä»¿ç‹å»ºç¡•æœ¬äººçš„å›ç­”ï¼š"""

    # å‘ç»™ChatBot
    assistant_response = st.session_state.chatbot.chat(user_message)

    # æ¸²æŸ“å¹¶å‚¨å­˜ChatBotæ¶ˆæ¯
    assistant_message = ""
    with st.chat_message(name="assistant", avatar="ğŸ¤–"):
        placeholder = st.empty()
        for token in assistant_response:
            assistant_message += token
            placeholder.write(assistant_message + "â–Œ")
        placeholder.empty()
        st.markdown(assistant_message)

    st.session_state.chatbot.add_message("assistant", assistant_message)
    st.session_state.messages.append(
        {"role": "assistant", "content": assistant_message}
    )
